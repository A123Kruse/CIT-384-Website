<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI or Real? — Image Guessing Game</title>
  <style>
    :root{--bg:#0b0f14;--card:#121923;--muted:#8aa0b7;--text:#e6eef6;--accent:#6ea8fe;--win:#19c37d;--ring:#263245}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:var(--text);background:#0b0f14;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{max-width:1100px;width:100%}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:14px}
    .title{font-weight:800;font-size:clamp(20px,2vw+8px,28px)}
    .meta{display:flex;gap:10px;color:var(--muted);font-size:14px}
    .pill{background:rgba(255,255,255,.06);padding:6px 10px;border:1px solid var(--ring);border-radius:999px}
    .bar{height:8px;background:#0a121a;border-radius:999px;overflow:hidden;border:1px solid var(--ring);margin-bottom:10px}
    .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#9bd2ff);transition:width .35s}
    .board{background:rgba(255,255,255,.04);border:1px solid var(--ring);border-radius:16px;padding:16px}
    .cards{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:820px){.cards{grid-template-columns:1fr 1fr}}
    .card{position:relative;background:#121923;border:1px solid var(--ring);border-radius:14px;overflow:hidden;outline:none;transition:.15s}
    .card:hover{transform:translateY(-2px)}
    .card:focus-visible{box-shadow:0 0 0 3px rgba(110,168,254,.5)}
    .frame{aspect-ratio:4/3;display:grid;place-items:center;background:#0c141d}
    .frame img{width:100%;height:100%;object-fit:cover;display:block}
    .label{position:absolute;top:10px;left:10px;padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.5);border:1px solid var(--ring);font-size:12px;text-transform:uppercase}
    .pick{position:absolute;bottom:10px;left:10px;right:10px;display:flex;gap:10px;pointer-events:none}
    .pick .btn{pointer-events:all;flex:1;padding:10px 12px;border-radius:10px;border:1px solid var(--ring);background:rgba(255,255,255,.06);color:var(--text);font-weight:700;cursor:pointer}
    .reveal{position:absolute;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);backdrop-filter:blur(2px)}
    .reveal.show{display:grid}
    .chip{padding:10px 14px;border-radius:999px;border:1px solid var(--ring);font-weight:800;text-transform:uppercase;background:rgba(255,255,255,.06)}
    .chip.win{border-color:rgba(25,195,125,.4);background:rgba(25,195,125,.12);color:#a5f5ce}
    .controls{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .btn-main{padding:12px 16px;background:linear-gradient(180deg,#172031,#121a28);color:var(--text);border:1px solid var(--ring);border-radius:12px;font-weight:800;cursor:pointer}
    .btn-main[disabled]{opacity:.55;cursor:not-allowed}
    .small{color:var(--muted);font-size:13px}
    .error{color:#ffbdbd}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">AI or Real?</div>
      <div class="meta" aria-live="polite">
        <span class="pill" id="scorePill">Score: 0</span>
        <span class="pill" id="roundPill">Round: –</span>
      </div>
    </header>

    <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Progress">
      <div id="progress"></div>
    </div>
    <p class="small">Pick the image that was generated by AI. Keys: <b>A</b>/<b>B</b> select, <b>R</b> reveal, <b>N</b> next.</p>

    <main class="board">
      <div id="status" class="small"></div>
      <div id="cards" class="cards"></div>
      <div class="controls">
        <button id="revealBtn" class="btn-main" disabled>Reveal</button>
        <div class="small" id="categoryNote"></div>
        <div>
          <button id="nextBtn" class="btn-main" disabled>Next</button>
          <button id="restartBtn" class="btn-main" style="display:none">Restart</button>
        </div>
      </div>
      <div id="error" class="error"></div>
      <p class="sr-only" id="ariaLive"></p>
    </main>
  </div>

  <script>
  (function(){
    const $ = (s, r=document)=>r.querySelector(s);
    const el = {
      cards: $('#cards'), progress: $('#progress'), score: $('#scorePill'), round: $('#roundPill'),
      reveal: $('#revealBtn'), next: $('#nextBtn'), restart: $('#restartBtn'),
      status: $('#status'), error: $('#error'), categoryNote: $('#categoryNote'), aria: $('#ariaLive')
    };

    const state = { rounds: [], i: 0, score: 0, picked: null, shuffleSides: true };
    const params = new URLSearchParams(location.search);
    state.shuffleSides = params.get('shuffle') !== 'false';

    start();

    async function start(){
      try{
        const res = await fetch('images/manifest.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('Could not load images/manifest.json');
        /** manifest shape:
         * { "animals": { "real": ["..."], "ai": ["..."] }, "landscapes": { "real":[...], "ai":[...] }, ... }
         */
        const manifest = await res.json();
        state.rounds = buildRoundsFromCategorizedManifest(manifest);
        await preload(state.rounds);
        resetGame();
      }catch(err){
        el.error.textContent = err.message;
        console.error(err);
      }
    }

    // Turn the categorized manifest into a list of rounds without repeats, pairing within the same category.
    function buildRoundsFromCategorizedManifest(m){
      /** Each round: { category, images: [{src,label,alt},{src,label,alt}] } */
      const categories = Object.keys(m);
      const rounds = [];
      for(const cat of categories){
        const real = Array.isArray(m[cat]?.real) ? [...m[cat].real] : [];
        const ai = Array.isArray(m[cat]?.ai) ? [...m[cat].ai] : [];
        // shuffle both lists to avoid bias
        shuffle(real); shuffle(ai);
        const n = Math.min(real.length, ai.length);
        for(let k=0;k<n;k++){
          const realFile = real[k];
          const aiFile = ai[k];
          rounds.push({
            category: cat,
            images: [
              { src: `images/real/${realFile}`, label: 'real', alt: autoAlt(realFile) },
              { src: `images/ai/${aiFile}`,   label: 'ai',   alt: autoAlt(aiFile) }
            ]
          });
        }
      }
      // Mix categories so gameplay feels varied
      shuffle(rounds);
      return rounds;
    }

    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
    function autoAlt(filename){ return String(filename).split('/').pop().replace(/\.[a-z0-9]+$/i,'').replace(/[-_]/g,' '); }

    async function preload(rounds){
      const tasks = [];
      for(const r of rounds){
        for(const img of r.images){
          tasks.push(new Promise(res=>{
            const im = new Image(); im.onload=res; im.onerror=res; im.src=img.src;
          }));
        }
      }
      await Promise.all(tasks);
    }

    function resetGame(){
      state.i = 0; state.score = 0; state.picked = null;
      el.restart.style.display = 'none';
      render();
      updateMeta();
    }

    function updateMeta(){
      el.score.textContent = `Score: ${state.score}`;
      el.round.textContent = `Round: ${Math.min(state.i+1, state.rounds.length)} / ${state.rounds.length}`;
      const pct = state.rounds.length ? Math.round((state.i)/state.rounds.length*100) : 0;
      el.progress.style.width = pct + '%';
      el.progress.parentElement.setAttribute('aria-valuenow', String(pct));
    }

    function current(){ return state.rounds[state.i]; }

    function render(){
      const r = current();
      if(!r){
        el.cards.innerHTML = '';
        el.status.innerHTML = `<strong>All done!</strong> You scored ${state.score} / ${state.rounds.length}.`;
        el.categoryNote.textContent = '';
        el.reveal.disabled = true; el.next.disabled = true;
        el.restart.style.display = 'inline-block';
        announce(`Game complete. Score ${state.score} out of ${state.rounds.length}`);
        el.progress.style.width = '100%';
        el.progress.parentElement.setAttribute('aria-valuenow','100');
        return;
      }

      let order = [0,1];
      if(state.shuffleSides) shuffle(order);

      el.cards.innerHTML = '';
      el.error.textContent = ''; el.status.textContent = `Round ${state.i+1}`; el.categoryNote.textContent = `Category: ${r.category}`;
      state.picked = null; el.reveal.disabled = false; el.next.disabled = true;

      order.forEach((srcIdx, visIdx)=>{
        const img = r.images[srcIdx];
        const card = document.createElement('button');
        card.className='card'; card.type='button';
        card.dataset.visualIndex = String(visIdx);
        card.dataset.srcIndex = String(srcIdx);
        card.setAttribute('aria-label', `Image ${visIdx===0?'A':'B'} — choose if this is AI-generated`);

        const label = document.createElement('div'); label.className='label'; label.textContent = visIdx===0?'A':'B';
        const frame = document.createElement('div'); frame.className='frame';
        const tag = document.createElement('img'); tag.src=img.src; tag.alt=img.alt; frame.appendChild(tag);
        const pick = document.createElement('div'); pick.className='pick';
        const guess = document.createElement('button'); guess.className='btn'; guess.type='button'; guess.textContent='This is AI';
        guess.addEventListener('click', e=>{ e.stopPropagation(); choose(visIdx); });
        pick.appendChild(guess);

        const reveal = document.createElement('div'); reveal.className='reveal'; reveal.innerHTML = `<span class="chip">${img.label.toUpperCase()}</span>`;

        card.append(label, frame, pick, reveal);
        card.addEventListener('click', ()=> choose(visIdx));
        el.cards.appendChild(card);
      });

      window.onkeydown = (e)=>{
        if(e.key.toLowerCase()==='a') choose(0);
        if(e.key.toLowerCase()==='b') choose(1);
        if(e.key.toLowerCase()==='r') doReveal();
        if(e.key.toLowerCase()==='n') doNext();
      };

      updateMeta();
      announce(`Round ${state.i+1}. Category ${r.category}. Choose which image is AI generated.`);
    }

    function choose(visIdx){
      if(!current()) return;
      el.cards.querySelectorAll('.card').forEach(c=>c.style.borderColor='var(--ring)');
      const card = el.cards.querySelector(`.card[data-visual-index="${visIdx}"]`);
      if(!card) return;
      state.picked = visIdx;
      card.style.borderColor='var(--accent)';
      el.status.textContent = `Selected ${visIdx===0?'A':'B'}. Click Reveal or press R.`;
      announce(`Selected ${visIdx===0?'A':'B'}.`);
    }

    function doReveal(){
      if(!current()) return;
      if(state.picked==null){ el.error.textContent='Pick an image first.'; announce('Pick an image first.'); return; }
      el.error.textContent='';

      const card = el.cards.querySelector(`.card[data-visual-index="${state.picked}"]`);
      const selectedSrcIdx = Number(card?.dataset.srcIndex||0);
      const round = current();

      const pickedIsAI = round.images[selectedSrcIdx].label === 'ai';
      const aiSrcIdx = round.images.findIndex(i=>i.label==='ai');
      const aiVisualIdx = Number(el.cards.querySelector(`.card[data-src-index="${aiSrcIdx}"]`)?.dataset.visualIndex||0);

      el.cards.querySelectorAll('.card').forEach(c=>{
        const overlay = c.querySelector('.reveal'); overlay.classList.add('show');
        const thisIsAI = Number(c.dataset.visualIndex)===aiVisualIdx;
        c.style.borderColor = thisIsAI ? 'var(--win)' : 'var(--ring)';
      });

      if(pickedIsAI){ state.score++; el.status.innerHTML='<strong>Correct!</strong> You picked the AI image.'; announce('Correct.'); }
      else{ el.status.innerHTML='<strong>Not quite.</strong> The other image is AI.'; announce('Incorrect.'); }

      el.score.textContent = `Score: ${state.score}`;
      el.reveal.disabled = true; el.next.disabled = false;
    }

    function doNext(){ if(!current()) return; state.i++; render(); }
    function announce(m){ el.aria.textContent=''; setTimeout(()=>el.aria.textContent=m,10); }

    // Buttons
    el.reveal.addEventListener('click', doReveal);
    el.next.addEventListener('click', doNext);
    el.restart.addEventListener('click', resetGame);
  })();
  </script>
</body>
</html>
